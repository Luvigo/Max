<!-- 
    LIMPIEZA ARQUITECTÓNICA - Sidebar
    
    ROLES VÁLIDOS ÚNICOS:
    - Tutor: Sección completa de gestión
    - Estudiante: Sección de área personal
    
    ❌ ELIMINADOS:
    - Sección de Admin (usa Django Admin /admin/)
    - Sección de Institución (institución es solo info)
-->
<aside class="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-logo">M</div>
        <div class="sidebar-brand">
            <span class="sidebar-brand-name">MAX-IDE</span>
            <span class="sidebar-brand-sub">Arduino Education</span>
        </div>
    </div>
    
    <nav class="sidebar-nav">
        <!-- Principal -->
        <div class="nav-section">
            <div class="nav-section-title">Principal</div>
            
            <a href="{% url 'dashboard' %}" class="nav-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            
            <a href="/?editor=true" class="nav-item {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
                <i class="fas fa-code"></i>
                <span>Editor IDE</span>
            </a>
        </div>
        
        {% if institution %}
        
        {% if user_role == 'tutor' %}
        <!-- ============================================ -->
        <!-- ✅ TUTOR -->
        <!-- ============================================ -->
        <div class="nav-section">
            <div class="nav-section-title">Mi Área</div>
            
            <a href="{% url 'tutor_dashboard' slug=institution.slug %}" class="nav-item {% if request.resolver_match.url_name == 'tutor_dashboard' %}active{% endif %}">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>Mi Dashboard</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/tutor/profile/" class="nav-item {% if request.resolver_match.url_name == 'tutor_profile' %}active{% endif %}">
                <i class="fas fa-user-tie"></i>
                <span>Mi Perfil</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/tutor/my-institution/" class="nav-item {% if request.resolver_match.url_name == 'tutor_my_institution' %}active{% endif %}">
                <i class="fas fa-building"></i>
                <span>Mi Institución</span>
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Gestionar</div>
            
            <a href="/i/{{ institution.slug }}/tutor/groups/" class="nav-item {% if 'group' in request.resolver_match.url_name %}active{% endif %}">
                <i class="fas fa-users"></i>
                <span>Mis Grupos</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/tutor/students/" class="nav-item {% if 'student' in request.resolver_match.url_name %}active{% endif %}">
                <i class="fas fa-user-graduate"></i>
                <span>Mis Estudiantes</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/tutor/courses/" class="nav-item">
                <i class="fas fa-book-open"></i>
                <span>Mis Cursos</span>
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Crear</div>
            
            <a href="/i/{{ institution.slug }}/tutor/groups/new/" class="nav-item">
                <i class="fas fa-layer-group"></i>
                <span>Nuevo Grupo</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/tutor/students/new/" class="nav-item">
                <i class="fas fa-user-plus"></i>
                <span>Nuevo Estudiante</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/tutor/activities/new/" class="nav-item">
                <i class="fas fa-clipboard-list"></i>
                <span>Nueva Actividad</span>
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Soporte</div>
            
            <a href="/i/{{ institution.slug }}/tutor/errors/" class="nav-item">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Ver Errores</span>
            </a>
        </div>
        {% endif %}
        
        {% if user_role == 'student' %}
        <!-- ============================================ -->
        <!-- ✅ ESTUDIANTE -->
        <!-- ============================================ -->
        <div class="nav-section">
            <div class="nav-section-title">Mi Área</div>
            
            <a href="{% url 'student_dashboard' slug=institution.slug %}" class="nav-item {% if request.resolver_match.url_name == 'student_dashboard' %}active{% endif %}">
                <i class="fas fa-user"></i>
                <span>Mi Dashboard</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/student/my-info/" class="nav-item {% if request.resolver_match.url_name == 'student_my_context' %}active{% endif %}">
                <i class="fas fa-id-card"></i>
                <span>Mi Información</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/student/my-institution/" class="nav-item {% if request.resolver_match.url_name == 'student_my_institution' %}active{% endif %}">
                <i class="fas fa-building"></i>
                <span>Mi Institución</span>
            </a>
        </div>
        
        <div class="nav-section">
            <div class="nav-section-title">Aprendizaje</div>
            
            <a href="/i/{{ institution.slug }}/student/activities/" class="nav-item {% if 'activities' in request.resolver_match.url_name %}active{% endif %}">
                <i class="fas fa-tasks"></i>
                <span>Mis Actividades</span>
            </a>
            
            <a href="/i/{{ institution.slug }}/student/courses/" class="nav-item">
                <i class="fas fa-book"></i>
                <span>Mis Cursos</span>
            </a>
        </div>
        {% endif %}
        
        {% endif %}
        
        <!-- Ayuda -->
        <div class="nav-section">
            <div class="nav-section-title">Ayuda</div>
            
            <a href="#" class="nav-item">
                <i class="fas fa-question-circle"></i>
                <span>Documentación</span>
            </a>
            
            <a href="#" class="nav-item">
                <i class="fas fa-bug"></i>
                <span>Reportar Problema</span>
            </a>
        </div>
    </nav>
    
    <div class="sidebar-footer">
        <div class="user-info">
            <div class="user-avatar">
                {{ user.first_name|slice:":1"|default:user.username|slice:":1"|upper }}
            </div>
            <div class="user-details">
                <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                <div class="user-role role-{{ user_role }}">
                    {% if user_role == 'tutor' %}
                        <i class="fas fa-chalkboard-teacher"></i> Tutor
                    {% elif user_role == 'student' %}
                        <i class="fas fa-user-graduate"></i> Estudiante
                    {% else %}
                        <i class="fas fa-user"></i> Usuario
                    {% endif %}
                </div>
            </div>
            <a href="{% url 'logout' %}" class="topbar-btn" title="Cerrar Sesión">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </div>
</aside>
