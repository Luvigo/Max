{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}{{ activity.title }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-content">
        <h1><i class="fas fa-tasks"></i> {{ activity.title }}</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'editor:student_dashboard' institution.slug %}">{{ institution.name }}</a></li>
                <li class="breadcrumb-item"><a href="{% url 'editor:student_courses_list' institution_slug=institution.slug %}">Mis Cursos</a></li>
                <li class="breadcrumb-item"><a href="{% url 'editor:student_activities_list' institution_slug=institution.slug course_id=activity.course.id %}">{{ activity.course.name }}</a></li>
                <li class="breadcrumb-item active">{{ activity.title }}</li>
            </ol>
        </nav>
    </div>
</div>

{% include 'partials/alerts.html' %}

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3>Detalles de la Actividad</h3>
            </div>
            <div class="card-body">
                {% if activity.objective %}
                <div class="mb-3">
                    <h5>Objetivo</h5>
                    <p>{{ activity.objective|linebreaks }}</p>
                </div>
                {% endif %}
                
                <div class="mb-3">
                    <h5>Instrucciones</h5>
                    <p>{{ activity.instructions|linebreaks }}</p>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Fecha Límite:</strong>
                        {% if activity.deadline %}
                        {{ activity.deadline|date:"d/m/Y H:i" }}
                        {% if activity.is_deadline_passed %}
                        <span class="badge badge-danger ml-2">Vencida</span>
                        {% endif %}
                        {% else %}
                        <span class="text-muted">Sin fecha límite</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <strong>Re-entrega:</strong>
                        {% if activity.allow_resubmit %}
                        <span class="badge badge-success">Permitida</span>
                        {% else %}
                        <span class="badge badge-danger">No permitida</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        {% if submission %}
        <div class="card mt-4">
            <div class="card-header">
                <h3>Mi Entrega</h3>
            </div>
            <div class="card-body">
                <p><strong>Estado:</strong> 
                    {% if submission.status == 'submitted' %}
                    <span class="badge badge-warning">Entregada</span>
                    {% elif submission.status == 'graded' %}
                    <span class="badge badge-success">Calificada</span>
                    {% else %}
                    <span class="badge badge-secondary">Pendiente</span>
                    {% endif %}
                </p>
                <p><strong>Intento:</strong> {{ submission.attempt }}</p>
                <p><strong>Fecha de Entrega:</strong> {{ submission.submitted_at|date:"d/m/Y H:i" }}</p>
                
                {% if submission.status == 'graded' and feedback %}
                <div class="mt-3">
                    <a href="{% url 'editor:student_submission_feedback' institution_slug=institution.slug submission_id=submission.id %}" 
                       class="btn btn-primary">
                        <i class="fas fa-comment"></i> Ver Feedback
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3>Acciones</h3>
            </div>
            <div class="card-body">
                {% if can_submit %}
                {% if not submission or submission.status != 'submitted' or activity.allow_resubmit %}
                <a href="{% url 'editor:student_activity_submit' institution_slug=institution.slug activity_id=activity.id %}" 
                   class="btn btn-primary btn-block mb-2">
                    <i class="fas fa-paper-plane"></i> Entregar Actividad
                </a>
                {% endif %}
                {% else %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    {% if activity.is_closed %}
                    Esta actividad está cerrada.
                    {% elif activity.is_deadline_passed %}
                    La fecha límite ya pasó.
                    {% else %}
                    La actividad no está disponible para entregas.
                    {% endif %}
                </div>
                {% endif %}
                
                <a href="{% url 'editor:student_activity_ide' institution_slug=institution.slug activity_id=activity.id %}" 
                   class="btn btn-primary btn-block">
                    <i class="fas fa-code"></i> Abrir IDE
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
